<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My Awesome Website</title>
</head>

<style>

:root {
   --perspective: 200px;
   --space-side-layers: 10%;
   --side-initial-move: 3%;
}

body {
   background: #efefef;
   margin: 0;
}

* {
   box-sizing: border-box;
}

main {
   height: 100vh;
   display: grid;
   place-items: center;
}

section {
   display: grid;
   /* width: 500px; */
   width: auto;
   /* height: 1000px; */
   height: auto;
   margin-inline: auto;
   /* border: 4px solid red;  */
   /* background: blue; */

   perspective: var(--perspective);
   transform-style: preserve-3d;
}

section div {
   grid-area: 1 / 1 / -1 / -1;
   /* width: 100%; */
   /* height: 100%; */
   /* max-height: 100%; */
   width: 500px;
   background-clip: content-box;
   /* position: absolute; */
   box-sizing: border-box;
   /* opacity: 0.8; */
   background-color: transparent !important;
   margin: 0;
}

section div img {
   width: 100%;
   height: 100%;
   margin: 0;
   padding: 0;
   /* border: 2px solid blue; */
}

.mockup-5 {
   background-color: red;
   transform: translate3d(calc(var(--space-side-layers) * 4), 0, -40px);
   /* scale: 0.8; */
}

.mockup-4 {
   background-color: blue;
   /* padding-right: calc(var(--space-side-layers) * 1); */
   transform: translate3d(calc(var(--space-side-layers) * 3), 0, -30px);
   /* scale: 0.85; */
}

.mockup-3 {
   background-color: green;
   /* padding-right: calc(var(--space-side-layers) * 2); */
   transform: translate3d(calc(var(--space-side-layers) * 2), 0, -20px);
   /* scale: 0.9; */
}

.mockup-2 {
   background-color: yellow;
   /* padding-right: calc(var(--space-side-layers) * 3); */
   /* padding-left: calc(var(--space-side-layers) * 2); */
   transform: translate3d(calc(var(--space-side-layers) * 1), 0, -10px);
   /* scale: 0.95; */
}

.mockup-1 {
   background-color: purple;
   /* padding-right: calc(var(--space-side-layers) * 4); */
   transform: translate3d(calc(var(--space-side-layers) * 0), 0, 0px);
   /* scale: 1; */
}

</style>

<body>
   <main>
      <section>
         <div class="mockup-1"><img src="phone.png"/></div>
         <div class="mockup-2"><img src="phone.png"/></div>
         <div class="mockup-3"><img src="phone.png"/></div>
         <div class="mockup-4"><img src="phone.png"/></div>
         <div class="mockup-5"><img src="phone.png"/></div>
      </section>
   </main>
    
</body>

<script type="module">
   import { CSSSpringEasing } from 'https://unpkg.com/spring-easing';


   let [easing, duration] = CSSSpringEasing({
      // (mass, stiffness, damping, velocity)
      // spring-in-out, spring, spring-in, sprint-out-in
      // easing: "spring-out-in(1.2, 80, 30, 1)",
      easing: "spring(7, 300, 40, 2)",
      // easing: "spring(16, 360, 55, 1)",
      // The number of decimal places to round to
      decimal: 5,
      quality: 1,
   })
   
   const supportsLinear = CSS.supports("transition-timing-function: linear(0, 0.25, 1)")

   if (supportsLinear) {
      easing = `linear(${easing})`
      duration = duration
   } else {
      easing = 'ease'
      duration = duration / 2.5
   }

   // const mockup_5 = document.querySelector('.mockup-5')

   // get `--perspective` value from :root

   const c_perspective = getComputedStyle(document.documentElement).getPropertyValue('--perspective')
   const c_spaceSideLayers = getComputedStyle(document.documentElement).getPropertyValue('--space-side-layers')
   const c_sideInitialMove = getComputedStyle(document.documentElement).getPropertyValue('--side-initial-move')

   const mockupElements = document.querySelectorAll('section > div')

   mockupElements.forEach((mockup, index) => {
      // get current transform translate X position
      const transformStart = getComputedStyle(mockup).transform // this is a matrix3d()
      // console.log(transform)
      
      const translateToX = `calc(${(index * 3.6) ** 0.95} * var(--side-initial-move))`
      const translateToZ = `-${((index + 1) * 10) ** 1.05 }px`
      const delayy = index * 90 + 0
      const brightness = index == 0 ? 1 : 1 - 0.4 - index * 0.03

      console.log(`translate3d(${translateToX}, 0, ${translateToZ})`)

      mockup.animate([
         // mockup.animate([{ transform: `translate3d(${computedX}, ${computedY}, ${computedZ * 2})` }],{
         { transform: transformStart },
         { transform: `translate3d(${translateToX}, 0, ${translateToZ})` }
      ],{
         fill: 'forwards',
         // easing: 'ease-in-out',
         easing: `${easing}`,
         duration: duration,
         delay: delayy
      })

      mockup.animate([
         { filter: `brightness(${brightness})` },
      ],{
         fill: 'forwards',
         easing: `${easing}`,
         duration: duration,
         delay: delayy
      })

   })
   
</script>

</html>
